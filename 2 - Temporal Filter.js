/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var imageCollection = ee.ImageCollection("projects/mapbiomas-workspace/TRANSVERSAIS/ZONACOSTEIRA"),
    geometry = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-51.85546875, 5.266007882805497],
          [-52.294921875, 3.337953961416485],
          [-51.317138671875, 0.39550467153201946],
          [-49.52124573640583, -0.6920858950288072],
          [-48.49365234375, -1.4610232806227417],
          [-42.890625, -3.8642546157213955],
          [-39.55078125, -4.740675384778361],
          [-35.9912109375, -6.358975327235661],
          [-36.38671875, -9.44906182688142],
          [-38.49609375, -11.695272733029402],
          [-39.7265625, -13.752724664396975],
          [-39.375, -15.961329081596647],
          [-40.25390625, -18.145851771694467],
          [-40.78125, -19.642587534013032],
          [-42.36328125, -22.105998799750555],
          [-45.52734375, -22.593726063929296],
          [-48.69140625, -24.686952411999144],
          [-49.39453125, -26.431228064506428],
          [-49.74609375, -28.613459424004418],
          [-52.3828125, -31.503629305773018],
          [-54.31640625, -32.99023555965106],
          [-52.91015625, -33.72433966174759],
          [-49.39453125, -30.14512718337612],
          [-48.33984375, -28.76765910569124],
          [-47.28515625, -25.482951175355307],
          [-44.47265625, -23.885837699861995],
          [-42.1875, -23.725011735951796],
          [-40.25390625, -22.593726063929296],
          [-37.6171875, -16.130262012034756],
          [-37.96875, -13.752724664396975],
          [-36.2109375, -12.039320557540572],
          [-34.1015625, -9.102096738726443],
          [-33.92578125, -6.315298538330034],
          [-38.14453125, -3.5134210456400323],
          [-42.01171875, -1.9332268264771106],
          [-45.17578125, -0.8788717828324148],
          [-47.63671875, 0.17578097424708533],
          [-49.921875, 1.9332268264771233],
          [-50.625, 3.8642546157214084]]]),
    geometry3 = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-51.1025822360009, 5.2725590978499275],
          [-51.84438551955839, 4.113193596151607],
          [-51.00095935815659, 1.8418777477927393],
          [-50.328759387391074, 1.5294608205071407],
          [-50.04764883384274, 1.3238495616971582],
          [-49.997735378457094, 1.1222077740966823],
          [-49.947751599107164, 0.8598407274790456],
          [-49.945612096148295, 0.5914519800066291],
          [-49.49609431944833, 0.40754370740444823],
          [-49.17843236566307, 0.0972799526620218],
          [-49.039188882411736, -0.061829940108135785],
          [-48.77093869101543, -0.06864251895528854],
          [-48.6372702110001, -0.17982479482539107],
          [-48.504938891379425, -0.295142940432142],
          [-48.482715058962754, -0.34854339729506273],
          [-48.50184692038164, -0.4246214893567736],
          [-48.53404564829208, -0.5361681334877253],
          [-48.78482847383691, -0.6592146812918158],
          [-48.66484060396323, -0.804145800385483],
          [-48.67802660043867, -0.857097761635147],
          [-48.724663644348254, -0.9691301776406565],
          [-48.812501997142704, -1.0454592240135085],
          [-48.883789135459665, -1.1155868252300654],
          [-48.909588393140325, -1.158477641780949],
          [-48.87276341480515, -1.2265942960780443],
          [-48.75272581039093, -1.2428054424792472],
          [-48.67388482362492, -1.3331642800834982],
          [-48.586309575544306, -1.4707360765291653],
          [-48.514840267983914, -1.4439638513702238],
          [-48.487348566115884, -1.363302271566542],
          [-48.340398633834525, -1.3559195849626935],
          [-48.20169892422109, -1.1205955750584646],
          [-48.20065466820739, -1.0171742653608868],
          [-48.045806574813355, -0.9247356509034177],
          [-47.77428926838604, -0.9267280359110136],
          [-47.35281557751409, -1.0332114869834585],
          [-47.29710989331329, -0.9998255130779304],
          [-47.335699339142366, -1.007286832775555],
          [-47.31860087779438, -0.9794366136634073],
          [-47.324968638019925, -0.9590857347559909],
          [-47.31922740669472, -0.8809408582778354],
          [-47.298504533196365, -0.837747453795068],
          [-47.25518396217399, -0.7941793558280382],
          [-47.22116354917216, -0.812902430431024],
          [-47.18012018783327, -0.8730705314895087],
          [-47.11633929590636, -0.9594529023060101],
          [-46.99831412774182, -1.0293595299935923],
          [-46.93052391377341, -0.9794887967136888],
          [-46.85886195154433, -0.9579859351787824],
          [-46.79625038184747, -0.968518257349136],
          [-46.77318352844759, -0.9875167038622191],
          [-46.77950300450999, -1.018299428891095],
          [-46.784036856330545, -1.0501677691262323],
          [-46.76776516577661, -1.0880709606217276],
          [-46.76627262158894, -1.1042406210582436],
          [-46.745897187496155, -1.117320957957842],
          [-46.73496377837398, -1.109978182927483],
          [-46.745117945552124, -1.0791894110831075],
          [-46.753215610633106, -1.0341453695959155],
          [-46.74299479363049, -1.0301851723185003],
          [-46.701835341228616, -1.005205938607899],
          [-46.66855253780642, -1.0150280131409375],
          [-46.65191069001571, -1.0443108095584122],
          [-46.64496269218648, -1.0750856745196353],
          [-46.6280988092023, -1.0880704121560512],
          [-46.60284380005379, -1.0801458092976817],
          [-46.607725615797904, -1.0655421280605433],
          [-46.60570339364847, -1.0513748827916476],
          [-46.58958610492306, -1.0470372736407825],
          [-46.573459247857784, -1.0532784057475817],
          [-46.55801855777463, -1.0821759403109756],
          [-46.49941650914275, -1.1376035333865278],
          [-46.43509266952526, -1.1357956973889374],
          [-46.39812302624483, -1.1239046613347292],
          [-46.36384512506805, -1.1570885469804797],
          [-46.33365807345194, -1.153084675016632],
          [-46.3092944311922, -1.1603494976771336],
          [-46.311874900024236, -1.17874105666215],
          [-46.30252169469611, -1.2133375608932802],
          [-46.305053766627225, -1.2354412998773447],
          [-46.31799219617426, -1.2537015127464104],
          [-46.33750732385431, -1.287888542938056],
          [-46.3398505516173, -1.315544029951288],
          [-46.29659950479976, -1.3215548438679483],
          [-46.24682052797573, -1.246987484987791],
          [-46.15876068316612, -1.2302951782959608],
          [-46.119533176328105, -1.2686296734974336],
          [-46.04322531290495, -1.2836224750587135],
          [-45.95634175368241, -1.3717418107698185],
          [-45.71788430757903, -1.5036624570556298],
          [-45.65975416441955, -1.4453759664635262],
          [-45.60596907674915, -1.5047779771233614],
          [-45.60516685204891, -1.5736040154971824],
          [-45.47292900071386, -1.5826219194409605],
          [-45.43976648440912, -1.5637938544982661],
          [-45.4382906568988, -1.6044858790166816],
          [-45.446479703616035, -1.6852320610621407],
          [-45.45194861500232, -1.727663737503745],
          [-45.41142487858917, -1.7722143459346757],
          [-45.38669418387815, -1.8243121249102885],
          [-45.29171355415281, -1.7955581020078129],
          [-45.23666852376027, -1.9259847956641578],
          [-45.20565053492692, -2.0083699211318455],
          [-45.160320064866426, -1.9982539086321816],
          [-45.1088165643298, -1.920453268538758],
          [-45.14589332029624, -1.8426500622006015],
          [-45.198072692990024, -1.7476773660978233],
          [-45.15480718229719, -1.7192772742614804],
          [-45.10657378199852, -1.7002699792467038],
          [-45.120909578095734, -1.6681158452160616],
          [-45.163385683678655, -1.6574043266985383],
          [-45.166035798701955, -1.6274744816800162],
          [-45.11503159942703, -1.582714990040808],
          [-45.077857573808444, -1.615244978373896],
          [-45.03930924025826, -1.6367922687772618],
          [-45.03303240480017, -1.6700075691652927],
          [-45.00897589717471, -1.7095399731371588],
          [-44.94303312384602, -1.6982828369964693],
          [-44.88498747902281, -1.7240879791118866],
          [-44.840857735661245, -1.7273819735912759],
          [-44.8345853593064, -1.7465306696657565],
          [-44.86166174865116, -1.7557619675652385],
          [-44.9002627832578, -1.7627795607810597],
          [-44.90933845338094, -1.76876763939601],
          [-44.91120487483528, -1.7880173857899415],
          [-44.8523998749896, -1.7887217729121792],
          [-44.927019312211485, -1.8130946473436365],
          [-44.886400893948576, -1.8493034110263369],
          [-44.853070211242255, -1.8422295188387452],
          [-44.82713506579489, -1.8668301173328155],
          [-44.79597116898293, -1.8746696298177525],
          [-44.798109745608144, -1.906871860435517],
          [-44.74297207644804, -1.9648244533336352],
          [-44.693427820458396, -2.0006668668959176],
          [-44.678953387501224, -2.1009354714169373],
          [-44.69128785996156, -2.1404369798695764],
          [-44.72801256555465, -2.1776853489319206],
          [-44.793755729148074, -2.23061600575786],
          [-44.982760295991, -2.4351657744482296],
          [-44.966910498719415, -2.46762566751535],
          [-44.78646362105087, -2.3070269171526707],
          [-44.758787272243296, -2.310730606258061],
          [-44.80384438555387, -2.4711327743880234],
          [-44.73712179114659, -2.518430923153521],
          [-44.70649486717764, -2.583247511932579],
          [-44.82164078043712, -2.6499631965012793],
          [-44.84078344960267, -2.758773471212396],
          [-44.92177046055997, -2.7885010412703397],
          [-44.896357572093905, -2.9213245082185213],
          [-44.86716781284167, -2.9616888816618836],
          [-44.77429195538696, -2.8392363587119043],
          [-44.709988596117796, -2.879493060901261],
          [-44.717655774623324, -2.991517177077868],
          [-44.7063883704231, -3.069477861289706],
          [-44.751568817985856, -3.0837799318810264],
          [-44.80300221659536, -3.0703604946869767],
          [-44.863054941374, -3.178833954270799],
          [-44.87368260147224, -3.351755296477467],
          [-44.7382329824037, -3.367186381038291],
          [-44.68255354768269, -3.3180544749877914],
          [-44.6474787368503, -3.253839497363121],
          [-44.585466831611654, -3.1550281896081316],
          [-44.54829496068305, -3.121391397201423],
          [-44.434956729868645, -3.0284613580121746],
          [-44.294527661708116, -2.9010684237103654],
          [-44.12681635549984, -2.8853643994271625],
          [-43.96596725015581, -2.839479355884219],
          [-43.98481283992953, -2.714746297757492],
          [-43.832008660049496, -2.709350334756418],
          [-43.60299379544131, -2.6826753408569637],
          [-43.408827222053105, -2.7173324051438867],
          [-43.36508525589397, -2.603901831625102],
          [-43.330961203815946, -2.5604347989996645],
          [-43.265930853957, -2.5354777714442007],
          [-43.244396709198895, -2.715744743126533],
          [-43.09837103258428, -2.6299529051876442],
          [-43.03840004629694, -2.73246421651209],
          [-42.83149147884234, -2.7087779729726824],
          [-42.80599842073303, -2.7104611616273444],
          [-42.75789024375979, -2.762054134313302],
          [-42.588948296109834, -2.802251689302712],
          [-42.43989839315981, -2.7889493676053334],
          [-42.30793179717972, -2.917838804378533],
          [-42.0969765538282, -2.9095515278311925],
          [-41.93332032110453, -2.925387078679624],
          [-41.79641349599518, -2.932887485363096],
          [-41.34676876327205, -1.7441823745959744],
          [-46.73637119598948, 0.05071728155903428],
          [-48.87824077408459, 0.6880200282691269],
          [-49.19711641481433, 1.983950818304431],
          [-50.16353884347524, 4.26538965651267]]]),
    geometry2 = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-41.34677021493849, -1.7441852448731208],
          [-41.796416705356364, -2.9328905223021264],
          [-41.597812535102264, -3.065741608493129],
          [-40.86373868364467, -3.083506603782476],
          [-40.56239063306566, -3.0355429250633987],
          [-40.32932125892529, -2.964211272750665],
          [-40.081134269146446, -2.98199853493206],
          [-39.216671112731774, -3.4624987579124302],
          [-37.8712000564617, -4.496499971705276],
          [-37.22393028508611, -5.045305891885955],
          [-36.48761571862411, -5.223691370035146],
          [-35.83885756509153, -5.197710681129453],
          [-35.571889747044, -5.329557450263507],
          [-35.439902282794264, -5.571656558383182],
          [-35.406723583306814, -5.819211640585357],
          [-35.28432198838709, -6.2551837421325995],
          [-35.17649590074245, -6.56029884400918],
          [-35.130807422667715, -6.793300870200368],
          [-35.031066940545884, -7.317225609803013],
          [-35.041184977120565, -7.562904171410357],
          [-34.99974264250534, -7.783296285978276],
          [-35.06818235033552, -8.117975351576606],
          [-35.21378968197723, -8.56658244415538],
          [-35.3385361271624, -8.879367818500281],
          [-35.57607025226048, -9.181192122947392],
          [-35.904500799681955, -9.504451067205904],
          [-36.071457527390294, -9.667745953793489],
          [-36.17266618837408, -9.928454287979545],
          [-36.378535570697636, -10.232097442855368],
          [-36.744046782467024, -10.497712328504399],
          [-37.13080535290834, -10.66563693695223],
          [-37.38073030100924, -10.968179511853728],
          [-37.66867380842871, -11.761827969616704],
          [-37.85548139347014, -12.160349490391978],
          [-38.02187735573261, -12.411755346438696],
          [-38.18972514913639, -12.493964941212106],
          [-38.34568380939095, -12.542616151454537],
          [-38.537659280349544, -12.589660221029094],
          [-38.69799997989742, -12.51595643500281],
          [-38.90214796913074, -12.563793030319724],
          [-38.95839788951923, -12.56992714054123],
          [-39.00367505570574, -12.632344332192599],
          [-39.02144961028307, -12.726336258856682],
          [-39.04055901608888, -12.98387277099228],
          [-39.081471261333945, -13.184251648153289],
          [-39.136292711828105, -13.393978715532425],
          [-39.18563416582754, -13.690258824613498],
          [-39.16662317787325, -14.026527009469607],
          [-39.13793492967375, -14.242492930723259],
          [-39.124961273793474, -14.425501404788967],
          [-39.189186696221896, -14.605970660175677],
          [-39.18754858921807, -14.80769779152304],
          [-39.037070413141464, -15.717209629678669],
          [-39.0233496146941, -15.958306112596858],
          [-39.170438221753216, -16.215192898106665],
          [-39.23072816508909, -16.86330278461518],
          [-39.29321059054013, -17.295726428562606],
          [-39.3164650639431, -17.51510529041313],
          [-39.43452875830178, -17.7200300520091],
          [-39.47620519890597, -17.848826939316545],
          [-39.519270156642506, -17.8991539415613],
          [-39.61370409512017, -17.98410599866193],
          [-39.77123140129157, -18.271062721053383],
          [-38.6613580611118, -18.83876551328429],
          [-38.03512994783341, -13.528157271915202],
          [-34.36536398573867, -8.873283006479367],
          [-34.18965137280588, -6.434274512806173],
          [-35.68391897147683, -4.684745662240626],
          [-37.793388039321826, -3.5451060833439882]]]),
    geometry4 = 
    /* color: #ffc82d */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-40.20180242175701, -19.75245341617632],
          [-40.320115676854755, -19.88882620645214],
          [-40.321696895532455, -20.10796617528298],
          [-40.417286937502354, -20.23809562919217],
          [-40.45384617954198, -20.453047426311315],
          [-40.80961535857341, -20.80353146224927],
          [-40.94402456358148, -21.03983629069628],
          [-41.04092454698616, -21.26677202172881],
          [-41.04749381859688, -21.373817400961318],
          [-41.052696908185794, -21.405090033878295],
          [-41.08262797905229, -21.446589183436785],
          [-41.22812875099595, -21.563479208097892],
          [-41.20922772064864, -21.820681685665228],
          [-41.219545886111234, -21.92888234568911],
          [-41.32381784740301, -21.901424305349366],
          [-41.4775255189503, -21.938468026989668],
          [-41.481669597856865, -22.05223796700067],
          [-41.55946735747398, -22.15232579271739],
          [-41.79077036077297, -22.306428186111223],
          [-41.93214872594933, -22.44653852793372],
          [-43.132357574242405, -22.647206010838207],
          [-43.65087998727091, -22.764605996077183],
          [-44.12017052656046, -22.883477261206714],
          [-44.493278847166266, -22.89138707963122],
          [-44.777247250704704, -23.02107940323966],
          [-44.89158998271273, -23.284208994870127],
          [-45.54555973189849, -23.620070540594376],
          [-46.40596235408532, -23.831118616926073],
          [-47.031677205797905, -24.193600320646787],
          [-47.2425882399931, -24.432247385633882],
          [-47.459464349317386, -24.59298507128453],
          [-47.71856488337778, -24.722777637782688],
          [-48.132555795028566, -25.050735747332286],
          [-47.20146487516695, -25.490355833452725],
          [-44.5620003438857, -23.64449084076832],
          [-42.18895407426328, -23.64449079576372],
          [-40.16747019564082, -22.431306760401682],
          [-38.65126931718572, -18.834533646775178],
          [-39.771434669966425, -18.270736257028716],
          [-39.89146864312437, -18.85401715107829],
          [-39.80668337616959, -19.238666559123725],
          [-39.87507042357481, -19.443939826908156]]]),
    geometry5 = 
    /* color: #00ffff */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-47.20001086592674, -25.490387863439995],
          [-48.114624693989754, -25.03583855563499],
          [-48.5387081233672, -25.22636907612911],
          [-48.82566265920906, -25.376195653367333],
          [-48.83953512759854, -25.78321441324064],
          [-48.91339655328608, -26.264691399692403],
          [-48.80769518746615, -26.4569690939238],
          [-48.71281046787135, -26.75791341960013],
          [-48.68434194855308, -26.809457818270698],
          [-48.71409851483878, -26.965269396767845],
          [-48.682797149718, -27.268333097281204],
          [-48.706347618807456, -27.491072023742355],
          [-48.71603993776159, -27.765610722934024],
          [-48.72440521603619, -28.021853938789477],
          [-48.891353875046036, -28.25159565883134],
          [-48.99743318662945, -28.419152989181494],
          [-48.91075549940388, -28.496569385881898],
          [-48.85722708025844, -28.529578649140042],
          [-48.79608196049435, -28.52680068614437],
          [-48.75447282920345, -28.556778191139692],
          [-48.45339635519292, -28.604509705348068],
          [-48.42292785644531, -28.545322548498216],
          [-48.394611711285165, -28.498412518052298],
          [-48.1695556640625, -28.057438520876673],
          [-48.1036376953125, -27.780771643348196],
          [-47.977294921875, -27.283925600229747],
          [-47.63671875, -26.35249785815401]]]),
    geometry6 = 
    /* color: #bf04c2 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-45.995635986328125, -0.9892925830239434],
          [-46.087646484375, -1.2529137515304316],
          [-45.867919921875, -1.3297985105274817],
          [-45.76629638671875, -1.049707819510088],
          [-45.918731689453125, -0.9906656690514684]]]),
    imageCollection2 = ee.ImageCollection("users/luizcf14/APICUM"),
    srtm = ee.Image("CGIAR/SRTM90_V4"),
    geometry7 = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-48.48558971864111, -28.504990850953533],
          [-48.96898815614111, -28.350405634872992],
          [-50.28734753114111, -29.14025556850714],
          [-52.15502331239111, -29.809755391251663],
          [-52.92406628114111, -31.210538917701925],
          [-54.04467174989111, -32.31554217525783],
          [-54.35228893739111, -33.91655406035331],
          [-53.12182018739111, -34.04409664007243],
          [-51.12230846864111, -32.204056920439896],
          [-49.05547420934613, -29.562025114285316]]]),
    geometry8 = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-49.62524548172951, -0.17689676791273315],
          [-49.43847790360451, -0.15492420391753098],
          [-49.19677868485451, -0.023088454575328127],
          [-48.81225720047951, 0.5372064080539064],
          [-49.48242321610451, 0.8118453150828894],
          [-49.65820446610451, 0.9216960082802511],
          [-49.68017712235451, 1.7564215369359115],
          [-50.25146618485451, 2.4810186511809675],
          [-50.70190563797951, 3.095521701546075],
          [-50.80078259110451, 3.896024809622245],
          [-50.987548828125, 4.520543320170965],
          [-51.416015625, 4.783346363253142],
          [-51.73882469309058, 4.286334844859552],
          [-51.76483154296875, 4.054932503196612],
          [-51.77495344367537, 3.9801528708851803],
          [-51.650513704257264, 3.9629065637020573],
          [-51.5993834591568, 4.051697033535713],
          [-51.59768406779449, 4.117186089525417],
          [-51.57126323351923, 4.144322882464247],
          [-51.522762959457566, 4.0533370510273095],
          [-51.446810870027434, 3.962346454581347],
          [-51.443217052960335, 4.032427078420781],
          [-51.44151581660935, 4.117778279101589],
          [-51.41613565380351, 4.173408708128958],
          [-51.47520012139239, 4.22741586193533],
          [-51.46834296942029, 4.300594337317094],
          [-51.53153745344787, 4.3100033395177855],
          [-51.530208299342405, 4.354833430929102],
          [-51.511402109935716, 4.38663652949751],
          [-51.419127327229944, 4.328063296671795],
          [-51.27941281832835, 4.1258379533706036],
          [-51.252701436533016, 4.0185480498802715],
          [-51.22403384105587, 3.9573864815568713],
          [-51.21617733644359, 3.865212306157802],
          [-51.23346632117563, 3.7356849307286337],
          [-51.19117574864629, 3.575257633260579],
          [-51.1340908291952, 3.629918513838796],
          [-51.1381070732474, 3.4076232876573878],
          [-51.077589060610194, 3.204292328539496],
          [-51.09115585960603, 3.093798366581894],
          [-50.99756904186415, 2.9057893950852716],
          [-50.97384999477504, 2.8813136795958996],
          [-50.99957008985996, 2.862324078134197],
          [-51.03521737095832, 2.8037705628002576],
          [-50.98606312517546, 2.7575592397845856],
          [-50.93691021910581, 2.7716999356041847],
          [-50.9435453845399, 2.691095972906667],
          [-50.93069845915926, 2.636906208941597],
          [-50.895880123101506, 2.626614377952562],
          [-50.88186142879647, 2.586138891326774],
          [-50.882948633978, 2.5518363125397645],
          [-50.881289025210776, 2.5154748214705847],
          [-50.88620516900676, 2.4664542810837315],
          [-50.82520541092185, 2.4174331506274482],
          [-50.784242285327366, 2.25695058696297],
          [-50.74980357914228, 2.188058084464626],
          [-50.79776194939262, 2.1726843716984563],
          [-50.789794921875, 2.0062148567113276],
          [-50.685743538855604, 1.993523952919006],
          [-50.562471782554326, 1.924557743515048],
          [-50.55593923972992, 1.808918837607254],
          [-50.42358759813135, 1.7421743984888483],
          [-50.37114772412667, 1.7101740140738237],
          [-50.384626685913645, 1.6562105015298485],
          [-50.28129400284803, 1.6280707964465932],
          [-50.19032396380061, 1.5024593098034542],
          [-50.053597943248405, 1.4859007296604188],
          [-50.002017244721856, 1.4583564663714366],
          [-49.988120628407955, 1.3902258150871747],
          [-49.94126527665924, 1.3049331036238812],
          [-50.013967480209885, 1.248213882880575],
          [-50.1107429483061, 1.2404473122924158],
          [-50.1031494140625, 1.3123115737364148],
          [-50.14503471137539, 1.3617368906507006],
          [-50.16769418430192, 1.331532752907019],
          [-50.196533203125, 1.2814204410878607],
          [-50.17867959357011, 1.2095942449498196],
          [-50.1443478482729, 1.1405137670368268],
          [-50.09628453997027, 1.0325589432758795],
          [-50.15190245032943, 1.0117933611110734],
          [-50.22640304488368, 0.9540388914988968],
          [-50.24992011446852, 0.9258475905451741],
          [-50.3009033203125, 0.9827882884260022],
          [-50.44029235839844, 0.927177729923484],
          [-50.3755758328698, 0.8713932141293005],
          [-50.378838645728706, 0.799130755711442],
          [-50.47737294131446, 0.7534729197301243],
          [-50.55908203125, 0.6415602605924848],
          [-50.41900634765625, 0.6333210244393958],
          [-50.36543970588923, 0.3188493962696551],
          [-50.215066791537424, 0.17259674254204108],
          [-49.8614501953125, 0.11422984185295039],
          [-49.84771773613443, -0.10137398420875648],
          [-49.75708091276465, -0.1466898162177612]]]),
    Filter = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[-37.26892404562727, -4.721794723920892],
           [-37.287120151584304, -4.741981726192152],
           [-37.25278787619368, -4.841197350580524],
           [-37.2263520241429, -4.869248797908965],
           [-37.26205759054915, -4.731032916663665]]],
         [[[-37.35286645895735, -4.675773009562037],
           [-37.356986332004226, -4.687749212588828],
           [-37.343253421847976, -4.6904866016210285],
           [-37.332782077853835, -4.69596134748805],
           [-37.317332553928054, -4.7084504505904565],
           [-37.30840616232649, -4.718715298987223],
           [-37.30222635275618, -4.713240732044989],
           [-37.321795749728835, -4.680221337472332],
           [-37.344798374240554, -4.674062106689107]]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// Temporal filter algorithm (v3)
// @author: Damares Resende
// @email: dcresende92@gmail.com

//------------------------------------- Flags -----------------------------------------
var F = 3;
var MG = 5;
var NFv = 12;
var PD = 23;
var NV = 10;
var AG = 33;
var AQ = 31;
var NO = 50;
var mask = -1;

var firstYear = 1985;
var lastYear = 2019;

//------------------------------- Load data function ----------------------------------
var loadData = function() {
  var maps = [];
  var i = 0; 
  for(var year = firstYear; year <= lastYear; year++){ 
    //var image = ee.Image('projects/mapbiomas-workspace/TRANSVERSAIS/MINERACAO5/class_'+year).rename('classification')
    var image_aqua = ee.Image('projects/mapbiomas-workspace/TRANSVERSAIS/AQUICULTURA_5/class_'+year).remap([0,1],[0,31]).rename('classification')
    image_aqua = image_aqua.updateMask(image_aqua.eq(31))
    var imgeMerge =ee.ImageCollection([image_aqua]).max()
    
    maps[i] = imgeMerge;
    var clusterizedImage;
    //clusterizedImage = ee.Image("projects/mapbiomas-workspace/TRANSVERSAIS/MINERACAO5/mosaic_"+year)
    clusterizedImage =  ee.Image('projects/samm/SAMM/Mosaic/'+year)
    
    clusterizedImage = clusterizedImage.select(0).unmask(0)
    var nodata = ee.Image(NO).mask(clusterizedImage.select(0).eq(0)).rename('classification').toByte();
   // Map.addLayer(nodata,{},'Not Observed - '+year,false)
    maps[i] =  maps[i].updateMask(maps[i].lte(33)).unmask(0);
    maps[i] = ee.ImageCollection([maps[i],nodata]).mosaic()
    //maps[i] =  maps[i].add(nodata.unmask(0))
    //Map.addLayer(maps[i],{},' '+year,false)
    i = i + 1;
  }

  return maps;
}
//--------------------------------- Rules for NO -----------------------------------------

// rule 1
var tfNOFirstYear = function(im1, im2, im3) {
  im1 = im1.where(im1.eq(NO).and(im2.neq(NO)).and(im2.neq(mask)),im2);
  return im1.where(im1.eq(NO).and(im2.eq(NO)).and(im3.neq(NO)).and(im3.neq(mask)),im3);
};

// rule 2
var tfNOCenterYear = function(im1, im2, im3) {
  im2 = im2.where(im2.eq(NO).and(im1.neq(NO)).and(im1.neq(mask)),im1);
  return im2.where(im2.eq(NO).and(im1.eq(NO)).and(im3.neq(NO)).and(im3.neq(mask)),im3);
};

// rule 3
var tfNOLastYear = function(im1, im2, im3) {
  im3 = im3.where(im3.eq(NO).and(im2.neq(NO)).and(im2.neq(mask)),im2);
  return im3.where(im3.eq(NO).and(im2.eq(NO)).and(im1.neq(NO)).and(im1.neq(mask)),im1);
};

//------------------------ General rules - Neighbors match ---------------------------

// rule 4
var tfFirstYearLastTwoMatch = function(im1, im2, im3) {
  return im1.where(im2.eq(im3).and(im2.neq(mask)),im2);
};
 
// rule 5
var tfCenterYearFirstAndLastMatch = function(im1, im2, im3) {
  return im2.where(im1.eq(im3).and(im1.neq(mask)),im1);
};

// rule 6
var tfLastYearFirstTwoMatch = function(im1, im2, im3) {
  return im3.where(im1.eq(im2).and(im1.neq(mask)),im1);
};

//----------------------- Specific rules - Depend on classes ---------------------------

// rule 7
var tfLastYearMGFirstTwoAGNVF = function(im1, im2, im3) {
  im3 = im3.where(im3.eq(MG).and(im2.eq(NV)).and(im1.eq(AG)).and(im2.neq(mask)),im2);
  return im3.where(im3.eq(MG).and(im2.eq(AG)).and(im1.eq(NV)).and(im2.neq(mask)),im2);
}

var fillGaps = function(imageList,classValue){
  var limit  = lastYear - firstYear
  print('Limit',limit)
  for(var i =0; i < limit; i = i +1){ //13
    var maskFiller = ee.Image(NO).mask(imageList[i].eq(NO));
    if(i < 32){
      for(var j =i; j < i+limit && j < limit; j = j +1){ // 13
         maskFiller = maskFiller.where(maskFiller.eq(NO).and(imageList[j].neq(NO)),imageList[j]);
      }
    }else{
        for(var j =i; j < i+limit && j < limit; j = j +1){ // 13
           maskFiller = maskFiller.where(maskFiller.eq(NO).and(imageList[j].neq(NO)),imageList[j]);
        }
        maskFiller = maskFiller.where(maskFiller.eq(NO).and(imageList[i-1].neq(NO)),imageList[i-1]);
        maskFiller = maskFiller.where(maskFiller.eq(NO).and(imageList[i-2].neq(NO)),imageList[i-2]);
        maskFiller = maskFiller.where(maskFiller.eq(NO).and(imageList[i-3].neq(NO)),imageList[i-3]);
 
    }
    imageList[i] = imageList[i].where(imageList[i].eq(NO),maskFiller.unmask(NO));
  }
  return imageList;
}

//------------------------------------- Filters -----------------------------------------

var filterCenterYears = function(maps) {
  // Safe backup copy
  var backup = [];
  for(var i = 0; i < (lastYear-firstYear)+1; i++){
    backup[i] = maps[i];
  }
  print(">> Rule for the center years\n\n");
  for(var control = 1; control <= 3; control++){
    i = control;
    for(var year = firstYear + control; year < lastYear; year++) {
      print("Filtering years: " + (year - 1) + " " + year + " " + (year + 1));
      print("Modifying year at index: " + i + " (" + year + ")\n\n");
      maps[i] = tfNOCenterYear(backup[i-1],backup[i],backup[i+1]);
      maps[i] = tfCenterYearFirstAndLastMatch(backup[i-1],maps[i],backup[i+1]);
      i = i + 3;
      year = year + 2;
    }
  }
  return maps;
}

var filterFirtsYears = function(maps) {
  // Safe backup copy
  var backup = [];
  for(var i = 0; i < (lastYear-firstYear)+1; i++){
    backup[i] = maps[i];
  }
  print(">> Rule for the first years\n\n");
  for(var control = 1; control <= 3; control++){
    i = control;
    for(var year = firstYear + control; year < lastYear; year++) {
      print("Filtering years: " + (year - 1) + " " + year + " " + (year + 1));
      print("Modifying year at index: " + (i-1) + " (" + (year-1) + ")\n\n");
      maps[i-1] = tfNOFirstYear(backup[i-1],backup[i],backup[i+1]);
      maps[i-1] = tfFirstYearLastTwoMatch(maps[i-1],backup[i],backup[i+1]);
      i = i + 3;
      year = year + 2;
    }
  }
  return maps;
}

var filterLastYears = function(maps) {
  // Safe backup copy
  var backup = [];
  for(var i = 0; i < (lastYear-firstYear)+1; i++){
    backup[i] = maps[i];
  }
  print(">> Rule for the last years\n\n");
  for(var control = 1; control <= 3; control++){
    i = control;
    for(var year = firstYear + control; year < lastYear; year++) {
      print("Filtering years: " + (year - 1) + " " + year + " " + (year + 1));
      print("Modifying year at index: " + (i+1) + " (" + (year+1) + ")\n\n");
      maps[i+1] = tfNOLastYear(backup[i-1],backup[i],backup[i+1]);
      maps[i+1] = tfLastYearFirstTwoMatch(backup[i-1],backup[i],maps[i+1]);
      maps[i+1] = tfLastYearMGFirstTwoAGNVF(backup[i-1],backup[i],maps[i+1]);
      i = i + 3;
      year = year + 2;
    }
  }
  return maps;
}

//------------------------------------ Run Filter --------------------------------------

var maps = loadData();
var originals = maps;
maps = fillGaps(maps,PD);
maps = filterCenterYears(maps);
//maps = filterFirtsYears(maps);
maps = filterLastYears(maps); 


for(var i = 0; i < (lastYear-firstYear)+1; i++){
  maps[i] = maps[i].updateMask(maps[i].neq(mask));
}
var palettes=require("users/mapbiomas/modules:Palettes.js")
var mapbiomasColors = palettes.get("classification2")
for(var i = 0; i < (lastYear-firstYear)+1; i++){
  Map.addLayer(maps[i],{min: 0, max: 33,palette:mapbiomasColors}, "Nmap " + (firstYear+i)+"    a",false);
}

var palettes=require("users/mapbiomas/modules:Palettes.js")
var mapbiomasColors = palettes.get("classification2")
var originals = loadData();
for(var i = 0; i < (lastYear-firstYear)+1; i++){
  Map.addLayer(originals[i].updateMask(originals[i].neq(mask)),{min: 0, max: 33,palette:mapbiomasColors}, "Map " + (firstYear+i),false);
}
 

for(var year = firstYear; year <= lastYear; year++) {
   var ROIFilter
  if(true){ // Filterd Regions
    ROIFilter = ee.Image(0).clip(Filter).toByte()
  }
  Export.image.toAsset({
      image: (ee.ImageCollection([(maps[(year-firstYear)]).rename('classification').toByte(),ROIFilter.rename('classification').toByte()]).mosaic()).set({'classification':'1','year':year,'version':'5','region':'Brasil'}).toByte(),
      description:'Mapbiomas5_ft_' + year,
      assetId: 'projects/mapbiomas-workspace/TRANSVERSAIS/AQUICULTURA_5/ft_2_'+year+'',
      scale: 30,
      maxPixels:1e13,
      region: geometry
    });
}